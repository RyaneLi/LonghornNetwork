@startuml
!theme plain

' System Initialization Flow
state "Initialization" as Init
state "Load Students\n(DataParser)" as Load
state "Build Graph\n(StudentGraph)" as Build
state "Main System State" as MainState

Init --> Load
Load --> Build
Build --> MainState

' Main Operations
state "Roommate Matching\n(GaleShapley)" as Roommate
state "Pod Formation\n(Prim's Algorithm)" as Pod
state "Referral Path Finding\n(Dijkstra's Algorithm)" as Referral

MainState --> Roommate
MainState --> Pod
MainState --> Referral

' Roommate Matching States
state "Unpaired Student" as Unpaired
state "Proposing State" as Proposing
state "Paired Student" as Paired

Unpaired --> Proposing : has preferences
Proposing --> Paired : match found
Proposing --> Unpaired : no match found

Roommate --> Unpaired
Paired --> MainState

' Friend Request States
state "Student A (idle)" as IdleA
state "Student A Sending" as SendingA
state "Student B Receiving" as ReceivingB
state "Both Friends" as Friends

IdleA --> SendingA : sends friend request
SendingA --> ReceivingB
ReceivingB --> Friends : accepts

' Chat Interaction States
state "Student A (idle)" as ChatIdleA
state "Student A Sending Message" as ChatSendingA
state "Student B Receiving Message" as ChatReceivingB
state "Chat History Updated" as ChatUpdated

ChatIdleA --> ChatSendingA : sends message
ChatSendingA --> ChatReceivingB
ChatReceivingB --> ChatUpdated : message added

' Graph Building States
state "Empty Graph" as EmptyGraph
state "Students Added" as StudentsAdded
state "Edges Added\n(if weight > 0)" as EdgesAdded
state "Complete Graph" as CompleteGraph

EmptyGraph --> StudentsAdded : add students
StudentsAdded --> EdgesAdded : calculate connections
EdgesAdded --> CompleteGraph

Build --> EmptyGraph
CompleteGraph --> MainState

' Referral Path Finding States
state "Start Student" as Start
state "Exploring Graph\n(Dijkstra)" as Exploring
state "Target Found\n(student with company)" as TargetFound
state "No Path Found\n(empty path)" as NoPath
state "Path Returned" as PathReturned

Start --> Exploring : initialize Dijkstra
Exploring --> TargetFound : found student with company
Exploring --> NoPath : no path exists
TargetFound --> PathReturned : reconstruct path

Referral --> Start
PathReturned --> MainState
NoPath --> MainState

' Pod Formation States
state "All Students\nUnassigned" as Unassigned
state "Forming Pods\n(MST)" as Forming
state "Pods Formed\n(groups)" as PodsFormed
state "Isolated Students\n(own pod)" as Isolated

Unassigned --> Forming : Prim's algorithm
Forming --> PodsFormed : groups created
Forming --> Isolated : single student

Pod --> Unassigned
PodsFormed --> MainState
Isolated --> MainState

' Concurrent Operations
state "Thread Pool Created" as ThreadPool
state "Friend Request Thread" as FRThread
state "Chat Thread" as CThread
state "Other Threads" as OtherThreads
state "All Threads Complete" as ThreadsComplete

ThreadPool --> FRThread : submit
ThreadPool --> CThread : submit
ThreadPool --> OtherThreads : submit
FRThread --> ThreadsComplete : synchronized operations
CThread --> ThreadsComplete : synchronized operations
OtherThreads --> ThreadsComplete : synchronized operations

note right of FRThread
  Thread-safe updates
  to friend lists
end note

note right of CThread
  Thread-safe updates
  to chat history
end note

@enduml

